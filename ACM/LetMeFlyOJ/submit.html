<!--
 * @Author: LetMeFly
 * @Date: 2022-05-02 15:31:41
 * @LastEditors: LetMeFly
 * @LastEditTime: 2022-05-03 14:38:59
-->
<!DOCTYPE html>
<html lang="zn">

<head>
    <meta charset="UTF-8">
    <title>提交代码</title>
    <script src="/Links/Common.js"></script>
</head>

<body>
    <center>
        <h1 id="OnlyH1Now">提交代码</h1>
        <form id="frmSolution" action="https://que.letmefly.xyz/LetMeFly/LetMeFlyOJ/submit/" method="post" onsubmit="submit_()" target="HiddenIframe">
            <input id="problem_id" type="hidden" value="6264" name="id">
            <span id="language_span">Language:
                <select id="language" name="language">
                    <option value="0">
                        C
                    </option>
                    <option value="1" selected="">
                        C++
                    </option>
                    <option value="3">
                        Java
                    </option>
                    <option value="6">
                        Python
                    </option>
                    <option value="7">
                        PHP
                    </option>
                    <option value="9">
                        C#
                    </option>
                    <option value="16">
                        JavaScript
                    </option>
                    <option value="17">
                        Go
                    </option>
                    <option value="18">
                        SQL
                    </option>
                </select>
            </span>
            <button id="Submit" type="button" class="ui primary icon button" onclick="submit_();">提交</button>
            <br/><br/>
            <textarea name="Code" id="Code" style="width: 60%; height: 500px;"></textarea>
        </form>
        <iframe id="HiddenIframe" name="HiddenIframe" style="width: 60%; height: 500px;" hidden></iframe>
    </center>
    <script>
        function submit_() {
            document.querySelector("#Code").setAttribute("hidden", "hidden");
            document.querySelector("#HiddenIframe").removeAttribute("hidden");
            document.getElementById("frmSolution").submit();
            document.querySelector("#Submit").innerHTML = "正在提交";
            document.querySelector("#Submit").setAttribute("onclick", "refreshResult();");
            document.querySelector("#Submit").setAttribute("disabled", "disabled");
            document.querySelector("#OnlyH1Now").innerHTML = "刷新结果";
            document.querySelector("#language_span").setAttribute("hidden", "hidden");
        }
        var submissionId;
        window.addEventListener('message', function(event) {
            if (event.origin == 'https://que.letmefly.xyz') {
                submissionId = event.data;
                const iframe = document.querySelector("#HiddenIframe");
                iframe.src = "https://que.letmefly.xyz/LetMeFly/LetMeFlyOJ/result/?submissionId=" + submissionId;
                document.querySelector("#Submit").innerHTML = "提交结果";
                document.querySelector("#Submit").removeAttribute("disabled");
            }
        }, false);
        // iframe.contentWindow.postMessage("主页面消息", "https://que.letmefly.xyz")
        function refreshResult() {
            const iframe = document.querySelector("#HiddenIframe");
            iframe.src = "https://que.letmefly.xyz/LetMeFly/LetMeFlyOJ/result/?submissionId=" + submissionId;
        }
    </script>
</body>