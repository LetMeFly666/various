<!--
 * @Author: LetMeFly
 * @Date: 2021-10-05 22:24:51
 * @LastEditors: LetMeFly
 * @LastEditTime: 2021-10-08 16:34:31
-->
<!DOCTYPE html>
<html lang="zn">

<head>
    <meta charset="UTF-8">
    <title>计算方法</title>
    <script src="../../Links/Common.js"></script>
    <style>
        .chapter {
            display: block;
            font-size: 1.3em;
            font-weight: 549;
            margin-left: 2em;
            margin-top: 1.2em;
        }
        .algorithm {
            margin-left: 4em;
            margin-right: 4em;
            margin-top: 0.4em;
        }
        .algorithm .unexpand {
            cursor: pointer;
        }
        .algorithm .expand {
            cursor: pointer;
            color: darkorange;
            font-size: 1.8em;
            font-weight: 550;
        }
        .algorithm .packUp {
            cursor: pointer;
            /* margin-bottom: 0.7em; */ /* 必须设置display: block才能体现 */
            font-size: 2em;
            color: #4cae78;
        }
        body {
            background-image: url("../../Links/Picture/PinkAli.jfif");
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
    </style>
</head>

<body>

    <h1 style="text-align:center">计算方法</h1><br /><hr />
    
    <a href="Codes">计算方法代码</a>
    <br /><hr />

    <div id="LetMeFly_Notes">
        <h2 style="font-size: 1.8em;">笔记</h2>
            <a class="chapter">Ch01</a>
                <div class="algorithm"><a class="unexpand" onclick="expand('Codes/Ch01_QinJiuShao/index.html', this)">秦九邵</a></div>
                <div class="algorithm"><a class="unexpand" onclick="expand('Codes/Ch01_KaiGenHao/index.html', this)">开根号</a></div>
                <div class="algorithm"><a class="unexpand" onclick="expand('Codes/Ch01_ErFenQiuGen/index.html', this)">二分求根</a></div>
                <div class="algorithm"><a class="unexpand" onclick="expand('Notes/Ch01_relaxationTechnique', this)">松弛技术</a></div>
                <div class="algorithm"><a class="unexpand" onclick="expand('Codes/Ch01_GeYuanShu', this)">割圆术</a></div>
                <div class="algorithm"><a class="unexpand" onclick="expand('Notes/Ch01_error', this)">割圆术</a></div>
            <a class="chapter">Ch02</a>
                <div class="algorithm"><a class="unexpand">开根号</a></div>
                <div class="algorithm"><a class="unexpand">开根号</a></div>
    </div>

    <script id="expandTheAlgorithm">
        var Iframe; // 为了调试的全局变量
        function expand(theLink, thisElement) {
            const theDiv = thisElement.parentNode;
            const iframe = theDiv.querySelector('iframe');
            if (iframe) {
                if (iframe.style.display == 'none') {
                    iframe.style.display = 'block';
                    thisElement.setAttribute('class', 'expand')
                    expandSmoothly(iframe, eval(iframe.getAttribute('shouldHeight')));
                    theDiv.querySelector('.packUp').style.display = 'block';
                }
                else {
                    expandSmoothly(iframe, 0, 0.8, callBackFunction = ()=>{iframe.style.display='none';});
                    thisElement.setAttribute('class', 'unexpand');
                    theDiv.querySelector('.packUp').style.display = 'none';
                }
            } else {
                const iframe = document.createElement('iframe');
                iframe.src = theLink;
                iframe.width = '100%';
                iframe.height = 0;
                theDiv.appendChild(iframe);
                setIframeHeight(iframe);
                thisElement.setAttribute('class', 'expand')
                const packUp = document.createElement('a');
                packUp.innerText = '▲ 收起';
                packUp.setAttribute('class', 'packUp');
                packUp.setAttribute('onclick', "this.parentNode.querySelector('.expand').click();");
                packUp.style.display = 'block';
                theDiv.appendChild(packUp);
            }
        }

        /* 将元素平滑展开（高度变成height） */
        /*      v
                ↑
                |   ________________
                |  /                \
                | /                  \
                |/                    \
            ----+--+---------------+---+-----> t
               0| 0.2             0.8  1
                |
            
            0.8 * V0 = diff  ==>  V0 = diff / 0.8
        */
        function expandSmoothly(element, height, time = 0.8, callBackFunction = null) {
            const nowHeight = element.offsetHeight;
            const diff = height - nowHeight;
            const beginSlowTime = time * 0.2;
            const endSlowTime = time * 0.2;
            const evenlyTime = time * 0.6;
            const V0 = diff / (time * 0.8);
            const a = V0 / (time * 0.2);
            var totalTime = 0;

            function begin() {
                element.height = nowHeight + 0.5 * a * totalTime * totalTime;
                totalTime += 0.01;
                if (totalTime <= beginSlowTime) {
                    setTimeout(() => {
                        begin();
                    }, 0.01);
                } else {
                    // console.log('After the first expand, the height is:', element.height);
                    // console.log('Should: ', nowHeight + diff / 8);
                    middle();
                }
            }

            function middle() {
                element.height = nowHeight + 0.5 * a * beginSlowTime * beginSlowTime + V0 * (totalTime - beginSlowTime);
                totalTime += 0.01;
                if (totalTime <= beginSlowTime + evenlyTime) {
                    setTimeout(() => {
                        middle();
                    }, 0.01);
                } else {
                    end();
                }
            }

            function end() {
                const thisTime = totalTime - beginSlowTime - evenlyTime;
                element.height = nowHeight + 0.5 * a * beginSlowTime * beginSlowTime + V0 * evenlyTime + V0 * thisTime - 0.5 * a * thisTime * thisTime;
                totalTime += 0.01;
                if (totalTime <= time) {
                    setTimeout(() => {
                        end();
                    }, 0.01);
                } else {
                    // console.log("Expanded");
                    if (callBackFunction) {
                        callBackFunction();
                    }
                }
            }

            begin();
        }

        function setIframeHeight(iframe) {
            Iframe = iframe;
            iframe.onload = () => {
                try {
                    const iframeWin = iframe.contentWindow || iframe.contentDocument.parentWindow;
                    if (iframeWin.document.body) {
                        const body = iframeWin.document.body;
                        iframe.setAttribute('shouldHeight', body.offsetHeight);
                        iframe.setAttribute('scrolling', 'no');
                        expandSmoothly(iframe, body.offsetHeight);
                    } else {
                        console.log('iframeWin.document.body 为空');
                    }
                } catch(error) {
                    expandSmoothly(Iframe, 500);
                    iframe.setAttribute('shouldHeight', 500);
                }
            }
        }
    </script>

</body>

</html>